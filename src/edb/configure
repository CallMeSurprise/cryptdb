#! /bin/sh

# -c computer name -d db name -o os name
# ./configure -c leopard -d mysql -o osx

rm Makefile
touch Makefile

# defaults
defos="ubuntu"
defdb="mysql"
defcomp="qubit"

while getopts o:d:c: option
do
case $option in
o)
   defos=$OPTARG
;;
d)
	defdb=$OPTARG
;;
c)
	defcomp=$OPTARG
;;
esac
done

echo "configure ... "

echo "machine ... " $defcomp

cat configs/$defcomp > Makefile

echo "os ... "  $defos	
if  [ "$defop" =  "osx" ] 
then
    echo "LIBFLAGS := -bundle -flat_namespace -undefined suppress" > tmp1
	cat Makefile  tmp1 > tmp2
	mv tmp2 Makefile
else
    echo "LIBFLAGS := -shared" > tmp1
	cat Makefile  tmp1 > tmp2
	mv tmp2 Makefile
fi

rm tmp1

echo "db ... " $defdb
if  [  "$defdb"  =  "mysql" ] 
then
    echo "#define MYSQL_S 1 //if this bit is set, we are working with MySQL, else we are working with Postgres" > configs/config.h
	cat Makefile configs/mysql > tmp2
else
    echo "#define MYSQL_S 0 //if this bit is set, we are working with MySQL, else we are working with Postgres" > configs/config.h
	cat Makefile configs/pg > tmp2
fi

mv tmp2 Makefile

grep "F_PATH" configs/$defcomp > tmp2 
cat configs/config.h tmp2 > tmp3
rm tmp2
mv tmp3 configs/config.h

cat Makefile configs/Makefile.in > tmp2
mv tmp2 Makefile

if  [  "$defdb"  =  "mysql" ] 
then
	echo "\ninstalludf: \n	cp edb.so" "\$(MYPLUGINPATH) \n" > tmp2
else
	echo "\ninstalludf: \n" > tmp2
fi

cat Makefile tmp2 > tmp3
mv tmp3 Makefile

echo "---> Makefile "

